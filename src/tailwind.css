@tailwind base;
@tailwind components;
@tailwind utilities;

/* Highlight.js theme - light mode */
@import "highlight.js/styles/github.css" layer(hljs);

/* Highlight.js theme - dark mode override */
.dark .hljs {
    color: #c9d1d9;
    background: transparent;
}
.dark .hljs-doctag,
.dark .hljs-keyword,
.dark .hljs-meta .hljs-keyword,
.dark .hljs-template-tag,
.dark .hljs-template-variable,
.dark .hljs-type,
.dark .hljs-variable.language_ {
    color: #ff7b72;
}
.dark .hljs-title,
.dark .hljs-title.class_,
.dark .hljs-title.class_.inherited__,
.dark .hljs-title.function_ {
    color: #d2a8ff;
}
.dark .hljs-attr,
.dark .hljs-attribute,
.dark .hljs-literal,
.dark .hljs-meta,
.dark .hljs-number,
.dark .hljs-operator,
.dark .hljs-selector-attr,
.dark .hljs-selector-class,
.dark .hljs-selector-id,
.dark .hljs-variable {
    color: #79c0ff;
}
.dark .hljs-meta .hljs-string,
.dark .hljs-regexp,
.dark .hljs-string {
    color: #a5d6ff;
}
.dark .hljs-built_in,
.dark .hljs-symbol {
    color: #ffa657;
}
.dark .hljs-code,
.dark .hljs-comment,
.dark .hljs-formula {
    color: #8b949e;
}
.dark .hljs-name,
.dark .hljs-quote,
.dark .hljs-selector-pseudo,
.dark .hljs-selector-tag {
    color: #7ee787;
}
.dark .hljs-subst {
    color: #c9d1d9;
}
.dark .hljs-section {
    color: #1f6feb;
    font-weight: 700;
}
.dark .hljs-bullet {
    color: #f2cc60;
}
.dark .hljs-emphasis {
    color: #c9d1d9;
    font-style: italic;
}
.dark .hljs-strong {
    color: #c9d1d9;
    font-weight: 700;
}
.dark .hljs-addition {
    color: #aff5b4;
    background-color: #033a16;
}
.dark .hljs-deletion {
    color: #ffdcd7;
    background-color: #67060c;
}

/* KaTeX error styling - make incomplete formulas less jarring during streaming */
.katex-error {
    color: inherit !important;
    opacity: 0.6;
}

.chat-message .katex-error {
    color: currentColor !important;
    background: transparent;
}

@layer base {
    html {
        @apply text-gray-700;
        font-family:
            var(--font-inter),
            "Inter",
            system-ui,
            -apple-system,
            sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    /* Default dark mode background - prevents white flash */
    html.dark,
    .dark {
        @apply bg-slate-900;
    }

    .dark body {
        @apply bg-slate-900 text-gray-200;
    }

    /* Subtle glow for sidebar logo */
    .sidebar-logo-glow {
        filter: drop-shadow(0 0 1px rgba(255, 255, 255, 0.5))
            drop-shadow(0 0 4px rgba(34, 211, 238, 0.25))
            drop-shadow(0 0 8px rgba(167, 139, 250, 0.15));
        transition: filter 0.3s ease;
    }

    .sidebar-logo-glow:hover {
        filter: drop-shadow(0 0 1px rgba(255, 255, 255, 0.6))
            drop-shadow(0 0 6px rgba(34, 211, 238, 0.35))
            drop-shadow(0 0 12px rgba(167, 139, 250, 0.25));
    }

    /* Streaming avatar glow effect */
    .streaming-avatar-glow {
        box-shadow:
            0 0 20px 3px rgba(34, 211, 238, 0.4),
            0 0 40px 6px rgba(34, 211, 238, 0.2);
    }

    /* Streaming avatar scanline effect */
    .streaming-avatar-scanline {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            to bottom,
            transparent 0%,
            rgba(34, 211, 238, 0.15) 50%,
            transparent 100%
        );
        height: 30%;
        animation: avatar-scanline 4s ease-in-out infinite;
    }

    @keyframes avatar-scanline {
        0% {
            transform: translateY(-100%);
            opacity: 0;
        }
        10% {
            opacity: 1;
        }
        90% {
            opacity: 1;
        }
        100% {
            transform: translateY(400%);
            opacity: 0;
        }
    }

    @keyframes avatar-glow-pulse {
        0%,
        100% {
            box-shadow:
                0 0 15px 2px rgba(34, 211, 238, 0.4),
                0 0 30px 4px rgba(34, 211, 238, 0.2);
        }
        50% {
            box-shadow:
                0 0 25px 4px rgba(34, 211, 238, 0.6),
                0 0 50px 8px rgba(34, 211, 238, 0.3);
        }
    }

    @keyframes shimmer {
        0% {
            transform: translateX(-100%);
        }
        100% {
            transform: translateX(100%);
        }
    }

    body {
        @apply leading-relaxed;
        letter-spacing: -0.011em;
    }

    p {
        @apply mb-4 leading-7;
        letter-spacing: -0.011em;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        @apply font-medium tracking-tight;
        letter-spacing: -0.015em;
    }

    h1 {
        @apply text-xl md:text-2xl leading-tight mb-4;
    }

    h2 {
        @apply text-lg md:text-xl leading-tight mb-3;
    }

    h3 {
        @apply text-base md:text-lg leading-snug mb-2;
    }

    h4 {
        @apply text-sm md:text-base leading-snug mb-2;
    }

    h5 {
        @apply text-sm leading-normal mb-2;
    }

    h6 {
        @apply text-xs leading-normal mb-2;
    }

    .border {
        @apply border-gray-300 dark:border-gray-600;
    }
}

@layer components {
    .lb-link {
        @apply text-sky-600 dark:text-sky-400 enabled:hover:text-sky-500 dark:enabled:hover:text-sky-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600 dark:focus-visible:outline-sky-400;
    }

    .lb-primary {
        @apply rounded-md bg-sky-600 disabled:bg-gray-300 dark:disabled:bg-gray-700 px-2.5 py-1.5 text-sm font-medium text-white disabled:text-gray-500 dark:disabled:text-gray-400 shadow-sm enabled:hover:bg-sky-500 enabled:active:bg-sky-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600 flex items-center gap-1 focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50 enabled:active:bg-sky-900;
    }

    .lb-success {
        @apply rounded-md bg-emerald-600 px-2.5 py-1.5 text-sm font-medium text-white shadow-sm enabled:hover:bg-emerald-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600 flex items-center gap-1 focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:opacity-50 enabled:active:bg-emerald-900;
    }

    .lb-danger {
        @apply rounded-md bg-rose-700 px-2.5 py-1.5 text-sm font-medium text-white shadow-sm enabled:hover:bg-rose-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-600 flex items-center gap-1 focus:ring-2 focus:ring-offset-2 focus:ring-rose-500 disabled:opacity-50 enabled:active:bg-rose-900;
    }

    .lb-warning {
        @apply rounded-md bg-amber-700 px-2.5 py-1.5 text-sm font-medium text-white shadow-sm enabled:hover:bg-amber-500 enabled:focus-visible:outline enabled:focus-visible:outline-2 enabled:focus-visible:outline-offset-2 enabled:focus-visible:outline-amber-600 flex items-center gap-1 enabled:focus:ring-2 enabled:focus:ring-offset-2 enabled:focus:ring-amber-500 enabled:active:bg-amber-900 disabled:bg-amber-800 disabled:text-amber-600 disabled:cursor-not-allowed;
    }

    .lb-secondary {
        @apply rounded-md bg-zinc-600 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm enabled:hover:bg-zinc-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zinc-600;
    }

    .lb-outline {
        @apply border rounded-md border-gray-300 dark:border-gray-600 px-2.5 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 shadow-sm enabled:hover:bg-gray-100 dark:enabled:hover:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-600 dark:focus-visible:outline-gray-400 disabled:opacity-50 enabled:active:bg-gray-200 dark:enabled:active:bg-gray-600 disabled:opacity-50 enabled:active:text-gray-800 dark:enabled:active:text-gray-200;
    }

    .lb-outline-secondary {
        @apply border rounded-md border-zinc-300 dark:border-zinc-600 px-2.5 py-1.5 text-sm font-semibold text-zinc-600 dark:text-zinc-300 shadow-sm enabled:hover:bg-zinc-100 dark:enabled:hover:bg-zinc-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zinc-600 dark:focus-visible:outline-zinc-400 disabled:opacity-50 enabled:active:bg-zinc-200 dark:enabled:active:bg-zinc-700 disabled:opacity-50 enabled:active:text-gray-800 dark:enabled:active:text-gray-100;
    }

    .lb-outline-danger {
        @apply border rounded-md border-rose-300 dark:border-rose-600 px-2.5 py-1.5 text-sm font-semibold text-rose-600 dark:text-rose-400 shadow-sm enabled:hover:bg-rose-300 dark:enabled:hover:bg-rose-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-600 dark:focus-visible:outline-rose-400 disabled:opacity-50 enabled:active:bg-rose-600 dark:enabled:active:bg-rose-600 disabled:opacity-50 enabled:active:text-gray-200 dark:enabled:active:text-gray-100;
    }

    .lb-danger {
        @apply rounded-md bg-rose-600 px-2.5 py-1.5 text-sm font-semibold text-white shadow-sm enabled:hover:bg-rose-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-rose-600 disabled:opacity-50 enabled:active:bg-rose-900;
    }

    .lb-sm {
        @apply rounded-md px-2.5 py-1.5 text-xs font-medium shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2;
    }

    .lb-input {
        @apply border rounded-md border-gray-300 dark:border-gray-600 px-2.5 py-1.5 text-base md:text-sm w-full text-gray-700 shadow-sm focus:ring-1 focus:ring-sky-600 focus:outline-0 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-300 bg-white dark:bg-gray-800 dark:text-gray-100 placeholder-neutral-400 focus:border-sky-600;
    }

    .lb-radio {
        @apply text-sky-600 dark:text-sky-400 focus:ring-1 focus:ring-sky-600 dark:focus:ring-sky-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-600 dark:focus-visible:outline-sky-400;
    }

    .white-button {
        @apply bg-white dark:bg-gray-800 enabled:hover:bg-gray-50 dark:enabled:hover:bg-gray-700 disabled:opacity-50 enabled:active:bg-gray-100 dark:enabled:active:bg-gray-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-300 dark:focus-visible:outline-gray-600;
    }

    .border {
        @apply border-gray-300 dark:border-gray-600;
    }

    .lb-select {
        @apply text-sm block w-full border border-gray-300 dark:border-gray-700 rounded-md py-1 text-gray-900 shadow-sm placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-2 focus:outline-gray-300 dark:focus:outline-gray-600 sm:leading-6 bg-white dark:bg-gray-800 dark:text-gray-100 focus:ring-1 focus:ring-sky-600 dark:focus:ring-sky-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:opacity-50;
    }
}

.direction-rtl {
    direction: rtl;
}

.direction-ltr {
    direction: ltr;
}

/* Mobile overflow utilities */
@layer utilities {
    .mobile-overflow-safe {
        @apply max-w-full overflow-x-auto;
    }

    .mobile-text-wrap {
        @apply break-words;
        overflow-wrap: anywhere;
    }

    .mobile-table-container {
        @apply overflow-x-auto max-w-full;
    }

    .mobile-table {
        @apply min-w-full border-collapse;
    }

    .mobile-table-cell {
        @apply break-words max-w-[200px] sm:max-w-none;
    }
}

/* Additional mobile overflow handling */
@layer components {
    /* Media grid and tiles */
    .media-grid {
        @apply grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 pt-4 pr-4 pb-4;
    }

    .media-tile {
        @apply relative aspect-square bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-md transition-shadow;
    }

    .media-wrapper {
        @apply w-full h-full bg-gray-100 dark:bg-gray-900 cursor-pointer overflow-hidden;
    }

    .media-prompt {
        @apply px-3 py-2 text-xs text-gray-600 dark:text-gray-400 line-clamp-2 overflow-hidden;
    }

    .selection-checkbox {
        @apply absolute top-2 right-2 z-10 w-6 h-6 rounded-full border-2 border-gray-200 dark:border-gray-600 bg-white/90 dark:bg-gray-800/90 shadow-md flex items-center justify-center cursor-pointer transition-all;
    }

    .selection-checkbox:hover {
        @apply scale-110 bg-white dark:bg-gray-700;
    }

    .selection-checkbox.selected {
        @apply bg-sky-500 border-sky-500;
    }

    .selection-checkbox.selected:hover {
        @apply scale-110 bg-sky-500 border-sky-500;
    }

    .selection-checkbox.selected svg {
        @apply text-white;
    }

    /* Chat and workspace grids */
    .chat-grid,
    .workspace-grid {
        @apply grid gap-4 w-full;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }

    /* Chat tiles - landscape cards for chat list */
    .chat-tile {
        @apply relative bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-md transition-shadow select-none;
        aspect-ratio: 2.2/1;
    }

    @media (min-width: 640px) {
        .chat-tile {
            aspect-ratio: 1.8/1;
        }
    }

    /* Workspace/Applet tiles */
    .workspace-tile {
        @apply relative bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm hover:shadow-md transition-shadow select-none;
        aspect-ratio: 2.2/1;
    }

    @media (min-width: 640px) {
        .workspace-tile {
            aspect-ratio: 1.8/1;
        }
    }

    /* Hamburger menu for tiles */
    .hamburger-menu {
        @apply absolute top-2 right-2 z-10 w-6 h-6 bg-white/90 dark:bg-gray-800/90 border-2 border-gray-200 dark:border-gray-600 rounded-full flex items-center justify-center transition-all cursor-pointer;
    }

    .hamburger-menu:hover {
        @apply scale-110 bg-white dark:bg-gray-700;
    }

    .hamburger-menu svg {
        @apply w-4 h-4 text-gray-600 dark:text-gray-300;
    }

    /* RTL support for tiles */
    html[dir="rtl"] .chat-tile .selection-checkbox,
    html[dir="rtl"] .chat-tile .hamburger-menu,
    html[dir="rtl"] .media-tile .selection-checkbox,
    html[dir="rtl"] .media-tile .hamburger-menu,
    html[dir="rtl"] .workspace-tile .selection-checkbox,
    html[dir="rtl"] .workspace-tile .hamburger-menu {
        right: auto;
        left: 0.5rem;
    }

    /* Chat message styles - User messages */
    .chat-message-user {
        @apply font-sans text-sm text-gray-900 dark:text-gray-300 whitespace-pre-wrap break-words leading-relaxed;
    }

    /* Chat message styles - Bot/AI messages */
    .chat-message-bot {
        @apply text-sm text-gray-900 dark:text-gray-300 font-sans leading-relaxed;
    }

    /* Polished markdown rendering for chat - clean editorial style */
    .chat-message {
        @apply text-sm text-gray-700 dark:text-gray-300 leading-relaxed mobile-overflow-safe;
    }

    .chat-message * {
        @apply mobile-text-wrap;
    }

    /* Paragraphs - comfortable reading rhythm */
    .chat-message p {
        @apply mb-4;
    }

    .chat-message p:last-child {
        @apply mb-0;
    }

    /* Headings - clean, no borders, proper hierarchy */
    .chat-message h1,
    .chat-message h2,
    .chat-message h3,
    .chat-message h4,
    .chat-message h5,
    .chat-message h6 {
        @apply font-semibold text-gray-900 dark:text-white leading-snug tracking-tight;
    }

    .chat-message h1 {
        @apply text-lg mt-5 mb-2;
    }

    .chat-message h2 {
        @apply text-base mt-5 mb-2;
    }

    .chat-message h3 {
        @apply text-sm mt-4 mb-1.5 font-semibold;
    }

    .chat-message h4 {
        @apply text-sm font-semibold mt-3 mb-1;
    }

    .chat-message h5 {
        @apply text-xs font-medium mt-2 mb-1 text-gray-700 dark:text-gray-300;
    }

    .chat-message h6 {
        @apply text-xs font-medium mt-2 mb-1 text-gray-600 dark:text-gray-400;
    }

    /* First element shouldn't have top margin */
    .chat-message > *:first-child {
        @apply mt-0;
    }

    /* Links - subtle underline */
    .chat-message a {
        @apply text-gray-900 dark:text-white underline decoration-gray-400 dark:decoration-gray-500 underline-offset-2 hover:decoration-gray-900 dark:hover:decoration-white transition-colors;
    }

    /* Citations - stand out with accent color */
    .chat-message a[href^="http"],
    .chat-message a[href^="https"] {
        @apply text-sky-600 dark:text-sky-400 no-underline hover:underline decoration-sky-400 dark:decoration-sky-500;
    }

    /* Anchor links (TOC, etc.) */
    .chat-message a[href^="#"] {
        @apply text-sky-600 dark:text-sky-400 no-underline hover:underline;
    }

    /* Footnote references - superscript style (only when in sup) */
    .chat-message sup a {
        @apply text-sky-600 dark:text-sky-400 no-underline hover:underline text-xs font-medium;
    }

    /* Lists - clean and compact */
    .chat-message ul,
    .chat-message ol {
        @apply my-4 pl-6;
    }

    .chat-message ul {
        @apply list-disc;
    }

    .chat-message ol {
        @apply list-decimal;
    }

    .chat-message li {
        @apply mb-1.5 leading-relaxed;
    }

    .chat-message li:last-child {
        @apply mb-0;
    }

    .chat-message li > ul,
    .chat-message li > ol {
        @apply mt-1.5 mb-0;
    }

    /* Inline code */
    .chat-message code:not(pre code):not(.hljs) {
        @apply bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 px-1.5 py-0.5 rounded text-xs font-mono;
    }

    /* Fallback for pre without CodeBlock */
    .chat-message pre:not(.code-block pre) {
        @apply bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 p-3 rounded-lg text-xs font-mono overflow-x-auto my-3 leading-snug border border-gray-200 dark:border-gray-800;
    }

    .chat-message pre code {
        @apply bg-transparent text-inherit p-0 rounded-none;
    }

    /* CodeBlock component - already styled in component, just ensure spacing */
    .chat-message .code-block {
        @apply my-3;
    }

    /* Blockquotes - minimal and elegant */
    .chat-message blockquote {
        @apply border-l-4 border-gray-300 dark:border-gray-600 pl-4 my-4 text-gray-600 dark:text-gray-400;
    }

    .chat-message blockquote p {
        @apply mb-0;
    }

    .chat-message blockquote blockquote {
        @apply mt-3;
    }

    /* Horizontal rules */
    .chat-message hr {
        @apply my-6 border-t border-gray-200 dark:border-gray-700;
    }

    /* Tables - clean minimal design */
    .chat-message table {
        @apply w-full border-collapse my-4 text-sm mobile-table;
    }

    .chat-message th,
    .chat-message td {
        @apply border-b border-gray-200 dark:border-gray-700 px-3 py-2 text-left mobile-table-cell;
    }

    .chat-message th {
        @apply font-semibold text-gray-900 dark:text-white;
    }

    /* Strong and emphasis */
    .chat-message strong {
        @apply font-semibold text-gray-900 dark:text-white;
    }

    .chat-message em {
        @apply italic mr-0.5;
    }

    /* Strikethrough */
    .chat-message del {
        @apply line-through text-gray-500;
    }

    /* Task lists */
    .chat-message input[type="checkbox"] {
        @apply mr-2 rounded border-gray-300 dark:border-gray-600 text-gray-900 focus:ring-gray-500;
    }

    /* Images - exclude media-card-image which has its own styling */
    .chat-message img:not(.media-card-image) {
        @apply max-w-full h-auto rounded my-4;
    }

    /* Definition lists */
    .chat-message dl {
        @apply my-4;
    }

    .chat-message dt {
        @apply font-semibold text-gray-900 dark:text-white mt-3;
    }

    .chat-message dd {
        @apply ml-0 mt-1 text-gray-700 dark:text-gray-300;
    }

    /* Citation blocks / sources */
    .chat-message cite {
        @apply block text-sm text-gray-500 dark:text-gray-400 mt-1 not-italic;
    }

    .chat-message cite::before {
        content: "â€” ";
    }

    /* Internal citations (cd_source) */
    .text-with-citations {
        @apply text-sky-600 dark:text-sky-400 hover:text-sky-700 dark:hover:text-sky-300 transition-colors;
    }

    .text-with-citations sup {
        @apply text-[0.7rem] font-semibold bg-sky-100 dark:bg-sky-900/50 px-1 py-0.5 rounded ml-0.5 hover:bg-sky-200 dark:hover:bg-sky-800/50;
    }
}
